##%######################################################%##
#                                                          #
####   Réalisation de graphiques pour l'étude              ####
###                                                        ###
##             Date : Avril 2024                           ##
#                                                          #
##%######################################################%##

###---------------------------------------------------------#
#### Nombre de données par Exploiton agricole ####
nb_obs_ea <- ggplot2::ggplot(data = nb_obs, 
                                   aes(x = Exploit, 
                                       y = nombre,
                                       fill = Exploit)) +
  geom_col(color = "black", fill = "blue")+
  geom_text(aes(label = nombre), vjust = 1.6, color = "white", position = position_dodge(0.9), size = 2.5) + 
  labs(
    title = "Volume d'observations retenues par Exploiton agricole",
    subtitle = "Région Bretagne, de 2014 à 2024",
    x = "Exploiton agricole",
    y = "Nombre d'observations")+
  theme(plot.title = element_text(color = "black",
                                  size = 12, 
                                  face = "bold"),
        axis.title = element_text(color = "black", 
                                  size = 10, 
                                  face = "bold"),
        axis.text.x = element_text(angle = 90)) +
  theme(legend.position = "bottom",
        legend.text = element_text(size=14),
        legend.title = element_blank())

plot(nb_obs_ea)

#### Richesse spécifique par Exploiton agricole ####
rs_ea <- ggplot2::ggplot(data = richesse_specifique, 
                             aes(x = Exploit, 
                                 y = nombre,
                                 fill = Exploit)) +
  geom_text(aes(label = nombre), vjust = 1.6, color = "white", position = position_dodge(0.9), size = 2.5) + 
  labs(
    title = "Distribution des observations, synthèse annuelle",
    subtitle = "Région Bretagne, de 2014 à 2024",
    x = "Années",
    y = "Nombre d'observations")+
  theme(plot.title = element_text(color = "black",
                                  size = 12, 
                                  face = "bold"),
        axis.title = element_text(color = "black", 
                                  size = 10, 
                                  face = "bold"),
        axis.text.x = element_text(angle = 90)) +
  theme(legend.position = "bottom",
        legend.text = element_text(size=14),
        legend.title = element_blank())

plot(rs_ea)




#### Diversité taxonomique à l'échelle des règnes ####
diversite_regne <- ggplot2::ggplot(data = nb_sp, 
                                   aes(x = cdNom, 
                                       y = nombre, 
                                       fill = rayon)) +
  geom_col(position = 'dodge') +
  scale_fill_brewer(palette = "YlGnBu") +
  geom_text(aes(label = nombre), vjust = 1.6, color = "black", position = position_dodge(0.9), size = 3.5) + 
  labs(
    title = "Diversité des êtres vivants (au niveau du règne) en fonction de l'Exploiton agricole concernée",
    subtitle = "Région Bretagne, de 2014 à 2024",
    x = "Règne (Animal, Végétal, Fongique)",
    y = "Nombre d'observations")+
  theme(plot.title = element_text(color = "black",
                                  size = 12, 
                                  face = "bold"),
        axis.title = element_text(color = "black", 
                                  size = 10, 
                                  face = "bold")) +
  theme(legend.position = "bottom",
        legend.text = element_text(size=14),
        legend.title = element_blank()) +
  facet_wrap(~ Exploit, scale ="free")

plot(diversite_regne)



#### Répartition des ateliers de production ####
groups_ea$Productions <- as.factor(groups_ea$Productions)

groups_ea <- groups_ea %>%
  arrange(desc(Productions)) %>%
  mutate(lab.ypos = cumsum(nombre_ea)-0.5* nombre_ea)

ggplot(groups_ea, aes(x = "", y = nombre_ea, fill = Productions)) +
  geom_bar(width = 1, stat = "identity", color = "white") +
  coord_polar("y", start = 0)+
  geom_text(aes(y= lab.ypos, label = nombre_ea), color = "black",size=2)+
  scale_fill_manual(values = c("bovins_viandes" = "sienna3",
                                "centre_equestre" = "darkorange",
                                "cidre" = "peachpuff2",
                                "horticulture" = "palegreen2",
                                "maraichage" = "forestgreen",
                                "methanisation" = "darkgreen",
                                "miel" = "grey",
                                "ovins" = "pink",
                                "photovoltaiques" = "palevioletred1",
                                "porcs" = "hotpink",
                                "poules_pondeuses" = "blue",
                                "vaches_laitieres" = "deepskyblue",
                                "volailles" = "cadetblue1"))+
  labs(
    title = "Répartition régionale du linéaire de la Trame Verte et Bleue",
    subtitle = "Région des Hauts-de-France, données des SRCE Nord-Pas-de-Calais et Picardie, 2015",
    fill = "Sous-trame des corridors écologiques")+
  theme_void()+
  theme(legend.position="right",
        legend.text=element_text(size=12),
        legend.title=element_text(size = 12, face="bold"))



#### Carte de chaleur de l'indice Jaccard ####
ggp <- ggplot2::ggplot(indice_jaccard) +
               geom_tile(aes(fill = value))   




#### Sauvegarde des graphiques ####
ggsave("Output/nb_obs_ea.jpeg",
       plot = nb_obs_ea,
       width = 11, 
       height = 8)


ggsave("Output/diversite_regne.jpeg",
plot = diversite_regne,
width = 11, 
height = 8)




