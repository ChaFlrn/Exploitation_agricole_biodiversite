##%######################################################%##
#                                                          #
####   Réalisation de graphiques pour l'étude              ####
###                                                        ###
##             Date : Avril 2024                           ##
#                                                          #
##%######################################################%##

###---------------------------------------------------------#
#### Nombre de données par Exploiton agricole ####
nb_obs_ea <- ggplot2::ggplot(data = nb_obs, 
                                   aes(x = Exploit, 
                                       y = nombre,
                                       fill = Exploit)) +
  geom_col(color = "black", fill = "blue")+
  geom_text(aes(label = nombre), vjust = 1.6, color = "white", position = position_dodge(0.9), size = 2.5) + 
  labs(
    title = "Volume d'observations retenues par Exploiton agricole",
    subtitle = "Région Bretagne, de 2014 à 2024",
    x = "Exploiton agricole",
    y = "Nombre d'observations")+
  theme(plot.title = element_text(color = "black",
                                  size = 12, 
                                  face = "bold"),
        axis.title = element_text(color = "black", 
                                  size = 10, 
                                  face = "bold"),
        axis.text.x = element_text(angle = 90)) +
  theme(legend.position = "bottom",
        legend.text = element_text(size=14),
        legend.title = element_blank())

plot(nb_obs_ea)


#### Diversité taxonomique à l'échelle des règnes ####
regne <- c("animalia", "animalia", "animalia", "fungi", "fungi", "fungi", "plantae", "plantae", "plantae")
categorie <- c("ordre", "especes", "total","ordre", "especes", "total","ordre", "especes", "total")

###---------------------------------------------------------#
cli::cli_h1("Rayon 5km")
nombre <- c(36, 249, 3293, 12, 17, 26, 73, 264, 941)
diversite_regne_5km <- base::data.frame(regne, categorie, nombre)

repartition_regne_5km <- ggplot2::ggplot(data = diversite_regne_5km, 
                                   aes(x = regne, 
                                       y = nombre, 
                                       fill = regne)) +
  geom_col(position = 'dodge') +
  scale_fill_manual(values = c("animalia" = "dodgerblue",
                    "fungi" = "sienna3",
                    "plantae" = "forestgreen")) +
  geom_text(aes(label = nombre), vjust = 1.6, color = "black", position = position_dodge(0.9), size = 2.5) + 
  labs(
    title = "Diversité des êtres vivants, autour des exploitations agricoles, rayon de 5km",
    subtitle = "Région Bretagne, de 2014 à 2024",
    x = "Règne",
    y = "Nombre")+
  theme(plot.title = element_text(color = "black",
                                  size = 12, 
                                  face = "bold"),
        axis.title = element_text(color = "black", 
                                  size = 10, 
                                  face = "bold")) +
  theme(legend.position = "bottom",
        legend.text = element_text(size=12),
        legend.title = element_blank()) +
  facet_wrap(~ categorie, 
             labeller = labeller(categorie = c("especes" = "Nombre_especes",
                                               "ordre" = "Nombre_ordres",
                                               "total" = "Nombre_observations")),
             scale ="free")

plot(repartition_regne_5km)

###---------------------------------------------------------#
cli::cli_h1("Rayon 2km")
nombre <- c(26, 100, 613, 5, 5, 6, 44, 94, 147)
diversite_regne_2km <- base::data.frame(regne, categorie, nombre)

repartition_regne_2km <- ggplot2::ggplot(data = diversite_regne_2km, 
                                         aes(x = regne, 
                                             y = nombre, 
                                             fill = regne)) +
  geom_col(position = 'dodge') +
  scale_fill_manual(values = c("animalia" = "dodgerblue",
                               "fungi" = "sienna3",
                               "plantae" = "forestgreen")) +
  geom_text(aes(label = nombre), vjust = 1.6, color = "black", position = position_dodge(0.9), size = 2.5) + 
  labs(
    title = "Diversité des êtres vivants, autour des exploitations agricoles, rayon de 2km",
    subtitle = "Région Bretagne, de 2014 à 2024",
    x = "Règne",
    y = "Nombre")+
  theme(plot.title = element_text(color = "black",
                                  size = 12, 
                                  face = "bold"),
        axis.title = element_text(color = "black", 
                                  size = 10, 
                                  face = "bold")) +
  theme(legend.position = "bottom",
        legend.text = element_text(size=12),
        legend.title = element_blank()) +
  facet_wrap(~ categorie, 
             labeller = labeller(categorie = c("especes" = "Nombre_especes",
                                               "ordre" = "Nombre_ordres",
                                               "total" = "Nombre_observations")),
             scale ="free")

plot(repartition_regne_2km)


#### Les espèces dominantes par règne ####
cli::cli_h1("Rayon 5km")

nom <- c("Goéland brun","Renard roux", "Blaireau européen", "Lapin de garenne", "Rapaces noctures",
         "Amanite rougissante", "Polypore du bouleau", "Amanite citrine", "Anthrus étoilé", "Polypore géant",
         "Ronce ligneuse", "Houx commun", "Fougère aigle", "Hêtre", "Châtaignier")

esp_dom_5km <- cbind(esp_dom_5km, nom)

plot_esp_dom_5km <- ggplot2::ggplot(data = esp_dom_5km, 
                                         aes(x = -rang, 
                                             y = pourcentage,
                                             fill = factor(regne),
                                    alpha = -rang)) +
  geom_col(position = 'dodge') +
  geom_text(aes(label = nom), 
            vjust = 0.5, 
            position = position_dodge(0.9),
            hjust = 1.2,
            color = "black",
            size = 2.5,
            angle = 90) + 
  labs(
    title = "Répartition des espèces dominantes par règne,\n autour des exploitations agricoles, dans un rayon de 5km",
    subtitle = "Région Bretagne, de 2014 à 2024 \n Source des données : SINP ",
    x = "Espèce",
    y = "Pourcentage")+
  theme(plot.title = element_text(color = "black",
                                  size = 12, 
                                  face = "bold"),
        axis.title = element_text(color = "black", 
                                  size = 10, 
                                  face = "bold"),
        axis.text.x = element_blank()) +
  theme(legend.position = "none",
        legend.text = element_text(size=12),
        legend.title = element_blank()) +
  facet_wrap(~ regne, scale = "free") +
  scale_alpha_continuous(range = c(0.3, 1))+
  scale_fill_manual(values = c("dodgerblue","sienna3","forestgreen"), name = "regne")

plot(plot_esp_dom_5km)


###---------------------------------------------------------#
cli::cli_h1("Rayon 2km")

nom <- c("Goéland brun","Renard roux", "Corneille noire", "Blaireau européen", "Mouette rieuse", 
         "Anthrus étoilé","Agaricales sp.","Collybie visqueuse","Polypore géant", "Polypore du bouleau",
         "Ronce ligneuse","Hêtre", "Houx commun", "Fougère aigle", "Bétoine officinale")

esp_dom_2km <- cbind(esp_dom_2km, nom)

plot_esp_dom_2km <- ggplot2::ggplot(data = esp_dom_2km, 
                                    aes(x = -rang, 
                                        y = pourcentage,
                                        fill = factor(regne),
                                        alpha = -rang)) +
  geom_col(position = 'dodge') +
  geom_text(aes(label = nom), 
            vjust = 0.5, 
            position = position_dodge(0.9),
            hjust = 1.1,
            color = "black",
            size = 2.5,
            angle = 90) + 
  labs(
    title = "Répartition des espèces dominantes par règne,\n autour des exploitations agricoles, dans un rayon de 2km",
    subtitle = "Région Bretagne, de 2014 à 2024 \n Source des données : SINP ",
    x = "Espèce",
    y = "Pourcentage")+
  theme(plot.title = element_text(color = "black",
                                  size = 12, 
                                  face = "bold"),
        axis.title = element_text(color = "black", 
                                  size = 10, 
                                  face = "bold"),
        axis.text.x = element_blank()) +
  theme(legend.position = "none",
        legend.text = element_text(size=12),
        legend.title = element_blank()) +
  facet_wrap(~ regne, scale = "free") +
  scale_alpha_continuous(range = c(0.3, 1))+
  scale_fill_manual(values = c("dodgerblue","sienna3","forestgreen"), name = "regne")

plot(plot_esp_dom_2km)




#### Répartition des ateliers de production ####
groups_ea$Productions <- as.factor(groups_ea$Productions)

groups_ea <- groups_ea %>%
  arrange(desc(Productions)) %>%
  mutate(lab.ypos = cumsum(nombre_ea)-0.5* nombre_ea)

ggplot(groups_ea, aes(x = "", y = nombre_ea, fill = Productions)) +
  geom_bar(width = 1, stat = "identity", color = "white") +
  coord_polar("y", start = 0)+
  geom_text(aes(y= lab.ypos, label = nombre_ea), color = "black",size=2)+
  scale_fill_manual(values = c("bovins_viandes" = "sienna3",
                                "centre_equestre" = "darkorange",
                                "cidre" = "peachpuff2",
                                "horticulture" = "palegreen2",
                                "maraichage" = "forestgreen",
                                "methanisation" = "darkgreen",
                                "miel" = "grey",
                                "ovins" = "pink",
                                "photovoltaiques" = "palevioletred1",
                                "porcs" = "hotpink",
                                "poules_pondeuses" = "blue",
                                "vaches_laitieres" = "deepskyblue",
                                "volailles" = "cadetblue1"))+
  labs(
    title = "Répartition régionale du linéaire de la Trame Verte et Bleue",
    subtitle = "Région des Hauts-de-France, données des SRCE Nord-Pas-de-Calais et Picardie, 2015",
    fill = "Sous-trame des corridors écologiques")+
  theme_void()+
  theme(legend.position="right",
        legend.text=element_text(size=12),
        legend.title=element_text(size = 12, face="bold"))



#### Carte de chaleur de l'indice Jaccard ####
ggp <- ggplot2::ggplot(indice_jaccard) +
               geom_tile(aes(fill = value))   




#### Sauvegarde des graphiques ####
ggsave("Output/nb_obs_ea.jpeg",
       plot = nb_obs_ea,
       width = 11, 
       height = 8)


ggsave("Output/repartition_regne_5km.jpeg",
plot = repartition_regne_5km,
width = 11, 
height = 8)

ggsave("Output/repartition_regne_2km.jpeg",
       plot = repartition_regne_2km,
       width = 11, 
       height = 8)


ggsave("Output/plot_esp_dom_5km.jpeg",
       plot = plot_esp_dom_5km,
       width = 11, 
       height = 8)

ggsave("Output/plot_esp_dom_2km.jpeg",
       plot = plot_esp_dom_2km,
       width = 11, 
       height = 8)

