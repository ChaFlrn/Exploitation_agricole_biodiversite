##%######################################################%##
#                                                          #
####   Récupération des bases de données                ####
###     Nettoyage et homogénéisation des variables       ###
##             Date : Avril 2024                           ##
#                                                          #
##%######################################################%##

###---------------------------------------------------------#
cli::cli_h1("Import des données naturalistes")

###---------------------------------------------------------#

# Observatoire de l'Environnement en Bretagne ------------------------------------------#
cli::cli_h2("Données OEB")

## Chargement du fichier ####
data_oeb <- utils::read.csv("Data/synthese_observations.csv", 
                            h = TRUE, 
                            dec = ",", 
                            sep = ";") 

## Précision des données ####
oeb <- data_oeb %>%
  dplyr::select(
    id_synthese,
    cd_ref,
    cd_nom,
    date_debut,
    nom_valide,
    nom_vernaculaire,
    nom_cite,
    regne,
    group2_inpn,
    classe,
    ordre,
    famille,
    rang_taxo,
    nombre_min,
    nombre_max,
    observateurs,
    communes,
    niveau_validation,
    validateur,
    geometrie_wkt_4326,
    x_centroid_4326,
    y_centroid_4326
  )

oeb[oeb$date_debut < "2014-01-01" , "Periode"] <- "historique"  
oeb[oeb$date_debut >= "2014-01-01" & oeb$date_debut < "2024-01-01", "Periode"] <- "voulue"
oeb[oeb$date_debut >= "2024-01-01", "Periode"] <- "futur" 

oeb <- dplyr::filter(oeb, Periode == "voulue")

## Sélection des données valides ####

oeb[oeb$niveau_validation == "Certain - très probable", "Validation"] <- "valide" 
oeb[oeb$niveau_validation == "Probable", "Validation"] <- "valide"
oeb[oeb$niveau_validation == "Douteux", "Validation"] <- "non_valide"
oeb[oeb$niveau_validation == "En attente de validation", "Validation"] <- "valide"

oeb <- dplyr::filter(oeb, Validation == "valide")

## Vérfication de la présence de doublons ####
oeb <- oeb[!duplicated(oeb$id_synthese), ]


###---------------------------------------------------------#

# Inventaire National du Patrimoine Naturel ------------------------------------------#
cli::cli_h2("Données SINP")
