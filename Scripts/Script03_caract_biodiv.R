##%######################################################%##
#                                                          #
####   Caractérisation simple de la biodiversité           ####
###     pour chaque exploitation agricole étudiée          ###
##             Date : Avril 2024                           ##
#                                                          #
##%######################################################%##

###---------------------------------------------------------#

#### Nombre de données disponibles par exploitation agricole ####
nb_obs <- sinp_ea_2km %>%
  dplyr::mutate(annees = as.numeric(substr(date, 1,4))) %>%
  dplyr::group_by(Code_EA, Exploit) %>%
  dplyr::summarise(nombre = n())


#### Richesse spécifique - Rs ####
richesse_specifique <- sinp_ea_2km %>%
  dplyr::group_by(Code_EA, Exploit, cdNom, nomCite) %>%
  dplyr::summarise(nombre = n()) %>%
  dplyr::group_by(Code_EA, Exploit) %>%
  dplyr::summarise(Rs = n())


#### Indice de Shannon - H ####
sinp_ea_2km$cdnom = as.numeric(sinp_ea_2km$cdNom)

indice_shannon <- sinp_ea_2km %>%
  dplyr::group_by(Code_EA, cdnom) %>%
  dplyr::summarise(nb = n()) %>%
  dplyr::group_by(Code_EA) %>%
  dplyr::summarise(H = vegan::diversity(nb, index = "shannon"))

#### Indice d'équitabilité de Piélou - E ####

indice_pielou <- richesse_specifique %>%
  base::cbind(indice_shannon) %>%
  dplyr::group_by(Code_EA) %>%
  dplyr::summarise(E = H/SciViews::ln(Rs))


#### Indice de Jaccard - I ####

indice_jaccard <- sinp_ea_2km %>%
  dplyr::group_by(Code_EA, cdnom) %>%
  dplyr::summarise(vegan::vegdist(sinp_ea_2km$cdnom, method = "jaccard"))


indice_jaccard <- sinp_ea_2km %>%
  dplyr::group_by(Code_EA, cdnom) %>%
  dplyr::summarise(nb = n()) %>%
  dplyr::group_by(Code_EA) %>%
  dplyr::summarise(I = vegan::vegdist(cdnom, method = "jaccard", binary = TRUE))

I = vegan::vegdist(sinp_transpo, method = "jaccard", binary = TRUE)
I

#### ANOVA ####

sinp_transpo <- sinp_ea_2km %>%
  dplyr::select(Code_EA,cdnom)
  
sinp_transpo <- sinp_transpo[!duplicated(sinp_transpo$cdnom), ]
 


 
sinp_transpo[sinp_transpo$Code_EA == "22001", "22001"] <- 1
sinp_transpo[sinp_transpo$Code_EA == "22002", "22002"] <- 1
sinp_transpo[sinp_transpo$Code_EA == "22003", "22003"] <- 1
sinp_transpo[sinp_transpo$Code_EA == "22004", "22004"] <- 1

sinp_transpo[sinp_transpo$Code_EA == "29001", "29001"] <- 1
sinp_transpo[sinp_transpo$Code_EA == "29002", "29002"] <- 1
sinp_transpo[sinp_transpo$Code_EA == "29003", "29003"] <- 1
sinp_transpo[sinp_transpo$Code_EA == "29004", "29004"] <- 1
sinp_transpo[sinp_transpo$Code_EA == "29005", "29005"] <- 1

sinp_transpo[sinp_transpo$Code_EA == "35001", "35001"] <- 1
sinp_transpo[sinp_transpo$Code_EA == "35002", "35002"] <- 1

sinp_transpo[sinp_transpo$Code_EA == "56001", "56001"] <- 1
sinp_transpo[sinp_transpo$Code_EA == "56002", "56002"] <- 1
sinp_transpo[sinp_transpo$Code_EA == "56003", "56003"] <- 1
sinp_transpo[sinp_transpo$Code_EA == "56004", "56004"] <- 1
sinp_transpo[sinp_transpo$Code_EA == "56005", "56005"] <- 1

sinp_transpo[is.na(sinp_transpo)] <- 0
sinp_transpo <- select(sinp_transpo,-Code_EA)

sinp_transpo <- t(sinp_transpo)
sinp_transpo <- transpose(sinp_transpo)


#base::t()#%>%
  #dplyr::group_by(Code_EA, cdnom)

sinp_transpo <- t(sinp_transpo$Code_EA)


str(sinp_ea_2km)

sinp_ea_2km <- as.data.frame(sinp_ea_2km)


tablo <- 

ind <- sinp_ea_2km %>%
  dplyr::group_by(cdnom, Code_EA) %>%
  dplyr::summarise(nombre = n())


s <- data.frame(Code_EA = c(ind$Code_EA),
                especes = c(tablo))
  



 
  
  
data("BCI")
bci_sub <- sample_n(BCI, 5)
