##%######################################################%##
#                                                          #
####   Caractérisation simple de la biodiversité           ####
###     pour chaque exploitation agricole étudiée          ###
##             Date : Avril 2024                           ##
#                                                          #
##%######################################################%##

###---------------------------------------------------------#

#### Nombre de données disponibles par exploitation agricole ####
sinp_ea_2km$cdnom = as.numeric(sinp_ea_2km$cdNom)


nb_obs <- sinp_ea_2km %>%
  dplyr::mutate(annees = as.numeric(substr(date, 1,4))) %>%
  dplyr::group_by(Code_EA, Exploit) %>%
  dplyr::summarise(nombre = n()) %>%
  sf::st_drop_geometry()


#### Mise en place du tableau pour les calculs d'indice de biodiversité ####
data_tests_bio <- sinp_ea_2km %>%
  dplyr::group_by(Code_EA, cdnom) %>%
  dplyr::summarise(nb = n()) %>%
  sf::st_drop_geometry()


data_tests_bio <- reshape2::dcast(data_tests_bio,
                                  Code_EA ~ cdnom,
                                  value.var = "nb",
                                  fun.aggregate = sum)


#### Richesse spécifique - Rs ####
richesse_specifique <- vegan::specnumber(data_tests_bio)
richesse_specifique


#### Indice de Shannon - H ####
indice_shannon <- vegan::diversity(data_tests_bio, index = "shannon")
indice_shannon

H_max <- log2(richesse_specifique)
H_max

#### Indice d'équitabilité de Piélou - E ####
indice_pielou <- indice_shannon/(SciViews::ln(richesse_specifique))
indice_pielou


recap_tests_bio <- data.frame(Code_EA = data_tests_bio$Code_EA,
                              Rs = richesse_specifique, 
                              H = indice_shannon,
                              Hmax = H_max,
                              E = indice_pielou)


#### Indice de Jaccard - I ####
indice_jaccard <-  vegan::vegdist(data_tests_bio, method = "jaccard", binary = TRUE)
indice_jaccard
plot(indice_jaccard)

indice_jaccard <-  vegan::vegdist(data_tests_bio, method = "jaccard", binary = FALSE)
indice_jaccard

plot(indice_jaccard)




#### Biodiversité et productions agricoles ####

prod_ea <- utils::read.csv(file = "Data/Brutes/desc_ea.csv", 
                             h = TRUE,
                             sep = ";",
                             dec = ",")








