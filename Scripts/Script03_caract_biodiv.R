##%######################################################%##
#                                                          #
####   Caractérisation simple de la biodiversité           ####
###     pour chaque exploitation agricole étudiée          ###
##             Date : Avril 2024                           ##
#                                                          #
##%######################################################%##

###---------------------------------------------------------#

#### Nombre de données disponibles par exploitation agricole ####
sinp_ea_2km$cdnom = as.numeric(sinp_ea_2km$cdNom)


nb_obs <- sinp_ea_2km %>%
  dplyr::mutate(annees = as.numeric(substr(date, 1,4))) %>%
  dplyr::group_by(Code_EA, Exploit) %>%
  dplyr::summarise(nombre = n())


#### Mise en place du tableau pour les calculs d'indice de biodiversité ####
data_tests_bio <- sinp_ea_2km %>%
  dplyr::group_by(Code_EA, cdnom) %>%
  dplyr::summarise(nb = n()) %>%
  sf::st_drop_geometry()


data_tests_bio <- reshape2::dcast(igf,
                                  Code_EA ~ cdnom,
                                  value.var = "nb",
                                  fun.aggregate = sum)


#### Richesse spécifique - Rs ####
richesse_specifique <- vegan::specnumber(data_tests_bio)
richesse_specifique

#### Indice de Shannon - H ####
indice_shannon <- vegan::diversity(data_tests_bio, index = "shannon")
indice_shannon

#### Indice d'équitabilité de Piélou - E ####
indice_pielou <- richesse_specifique %>%
  base::cbind(indice_shannon) %>%
  dplyr::group_by(Code_EA) %>%
  dplyr::summarise(E = H/SciViews::ln(Rs))

indice_pielou <- indice_shannon/(SciViews::ln(richesse_specifique))
indice_pielou


recap <- data.frame(richesse_specifique, indice_shannon, indice_pielou)



#### Indice de Jaccard - I ####
indice_jaccard <-  vegan::vegdist(data_tests_bio, method = "jaccard", binary = TRUE)
indice_jaccard









