##%######################################################%##
#                                                          #
####   Caractérisation simple de la biodiversité           ####
###     pour chaque exploitation agricole étudiée          ###
##             Date : Avril 2024                           ##
#                                                          #
##%######################################################%##

###---------------------------------------------------------#
#### Caractérisation générale de la biodiversité ####
cli::cli_h1("Nombre de données par exploitation")

sinp_ea_2km$cdnom = as.numeric(sinp_ea_2km$cdNom)

nb_obs <- sinp_ea_2km %>%
  dplyr::mutate(annees = as.numeric(substr(date, 1,4))) %>%
  dplyr::group_by(Code_EA, Exploit) %>%
  dplyr::summarise(nombre = n()) %>%
  sf::st_drop_geometry()


###---------------------------------------------------------#
#### La biodiversité autour des exploitations agricoles ####
cli::cli_h1("Indices de biodiversité")

# Mise en place du tableau pour les calculs d'indice de biodiversité #
data_tests_bio <- sinp_ea_2km %>%
  dplyr::group_by(Code_EA, cdnom) %>%
  dplyr::summarise(nb = n()) %>%
  sf::st_drop_geometry()

data_tests_bio <- reshape2::dcast(data_tests_bio,
                                  Code_EA ~ cdnom,
                                  value.var = "nb",
                                  fun.aggregate = sum)

cli::cli_h2("Calcul indicateurs biodiversité par exploitations")


biodiv_ea <- indic_biodiv(data_biodiv = data_tests_bio, 
                          code = data_tests_bio$Code_EA)


H_max <- log2(richesse_specifique)
H_max



cli::cli_h2("Indice de Jaccard")
##### Indice de Jaccard - I #####
indice_jaccard <-  vegan::vegdist(data_tests_bio, method = "jaccard", binary = TRUE)
indice_jaccard
plot(indice_jaccard)

indice_jaccard <-  vegan::vegdist(data_tests_bio, method = "jaccard", binary = FALSE)
indice_jaccard

plot(indice_jaccard)



